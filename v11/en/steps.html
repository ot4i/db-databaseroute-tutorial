<!DOCTYPE html>
<html class="no-js" lang="en">
 
	
<!-- header::Start -->
	<head>
		<!-- Use Internet Explorer 9 Standards mode for Eclipse Browser Control - https://www.eclipse.org/swt/faq.php#browsernativeie and https://msdn.microsoft.com/en-us/library/jj676915%28v=vs.85%29.aspx -->
  		<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
		
		<!-- Next 2 http=equiv headers required to disable caching the Eclipse Browser Widget -->
		<meta http-equiv="Pragma" content="no-cache">
  		<meta http-equiv="Expires" content="-1">

		<meta charset="UTF-8"> 
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<meta name="copyright" content="Copyright IBM Corporation 2014" />
		<meta name="abstract" content="IBM App Connect Enterprise V11 Tutorial">
		<meta name="author" content="IBM">
		<meta name="description" content="IBM App Connect Enterprise V11 Tutorial">
		<meta name="keywords" content="keywords" > 
		<meta name="robots" content="index,follow">
		<meta name="source" content="IBM App Connect Enterprise V11 Tutorial" /> 
		
		<title>IBM App Connect Enterprise V11 Tutorial</title>

    	<link rel="stylesheet" href="https://ot4i.github.io/iib-tutorials/css/main.css" />
		<link rel="stylesheet" href="https://ot4i.github.io/iib-tutorials/css/app.css" />
    	
		<script src="https://ot4i.github.io/iib-tutorials/js/json2.js"></script>
		<script src="https://ot4i.github.io/iib-tutorials/js/js2java.js"></script>
		<script src="https://ot4i.github.io/iib-tutorials/js/js2java_steps.js"></script>
		<script src="https://ot4i.github.io/iib-tutorials/js/vendor/modernizr.js"></script>
	</head>
<!-- header::End -->
<!-- body::Start -->
		<body>
  	<!-- body content here -->
	<div class="row">
	  <div class="small-12 medium-12 large-12 columns">
	    <p> </p>
	  </div>
	</div>
	<div class="row">
	  <div class="small-9 medium-9 large-9 columns">
	    <h4 class="title">Databases - Using a DatabaseRoute node to route messages based on data from DB2 via JDBC <action><button class="small radius button" tabindex="0" id="stepsViewDetails" onclick="viewDetails()"> View Details</button> </action></h4>
	  </div>
	  <div class="small-3 medium-3 large-3 columns">
		<a href="javascript:;" onclick="openHelpSystem('/com.ibm.etools.msgbroker.helphome.doc/help_home_msgbroker.htm')" class="small right helplink">IBM Knowledge Center</a> 
	  </div>
	</div> 
	<hr>
	<div class="row">
		<div class="small-10 medium-10 large-10 columns">
		<h5> Learn how to use the DatabaseRoute node to route messages based on data from DB2 using a message flow driven by a JSON message over HTTP. </h5>
		</div>
		<div class="small-2 medium-2 large-2 columns">
			<button class="small radius button right" tabindex="0" id="backToGallery" onclick="backToGallery()"> Back To Gallery
			</button>
		</div>
	</div>
	<div class="row">          
		  <div class="small-12 medium-12 large-12 columns">
			<ul class="tabs vertical"> 
				<li class="tab-title tab-title-small active">
				  <a href="javascript:;" onclick="show('panel21')">Create</a> 
				</li>
				<li class="tab-title tab-title-small">
				  <a href="javascript:;" onclick="show('panel31')">Prepare</a> 
				</li>
				<li class="tab-title tab-title-small">
				  <a href="javascript:;" onclick="show('panel41')">Run</a> 
				</li>
			</ul>
			<!-- editing -->
			<div class="tabs-content panel-thin-blue vertical"> 
		    	<div class="content active" id="panel21">
		    		
		    		<div class="small-10 medium-10 large-10 columns divider">
					
				      	<div class="row content-details">
					      	<h4>Import projects</h4>
					        
						    
								<p> When you click Import, two projects will be created in your workspace: An application named <span class="application">ExampleDatabaseRoute</span>, and the policy project named <span class="application">MyPolicies</span>. </p>
								
							
								<p> <span class="application">ExampleDatabaseRoute</span> provides a single message flow named <span class="resource">DatabaseRouteFlow</span> which uses an HTTPInput node to receive a JSON input message, a DatabaseRoute node to communicate with DB2, several FileOutput nodes which write each input message to a specific file based upon the data retrieved from the database and an HTTPReply node. </p>
								
							
								<p> <span class="application">MyPolicies</span> contains a single policy named <span class="application">MyJDBCPolicy</span>. The policy supplies configuration information controlling how the JDBC connection to the database will be made by the IBM App Connect Enterprise runtime. The policy has been set up with the standard values below which you should review to ensure they match with your environment:<br><code><span class="cmdname">Name of the database = USERS</span></code><br><code><span class="cmdname">Connection URL format = jdbc:db2://[serverName]:[portNumber]/[databaseName]:currentSchema=MYSCHEMA;user=[user];password=[password];</span></code><br><code><span class="cmdname">Database server name = localhost</span></code><br><code><span class="cmdname">Database server port number = 50000</span></code><br><code><span class="cmdname">Type 4 driver class JARs URL = C:\Program Files\IBM\SQLLIB\java</span></code><br><code><span class="cmdname">Security identity (DSN) = mydbidentity</span></code><br><code><span class="cmdname">Supports XA coordinated transactions = false</span></code> </p>
								
							
								<p> Once imported using the link on the right, the provided projects are ready to be deployed and tested. Both of these projects will be deployed to the same integration server using a provided BAR file. Before you do this, you will need to create the required DB2 database, as described on the Prepare tab. </p>
								
							
						</div>
						
						<div class="row content-details">
							<h4>Find out more</h4>
							<ul>
							
								
																
								<li> <a href="javascript:;" onclick="openHelpSystem('/com.ibm.etools.mft.doc/bi12002_.htm')" title="Knowledge Center link to Developing integration solutions by using applications">Developing integration solutions by using applications</a> </li>
							   	
							
							</ul>
						</div>
						
					</div>
					
					<div class="small-2 medium-2 large-2 columns">
					
					
					<h4 class="tkaction"><a href="javascript:;" onclick="importArtifacts(); openResource('MainFlow')"> Import <img class="icon-image" src="https://ot4i.github.io/iib-tutorials/images/icons/ibmdesign/back-right-previous_128-orange.png"></a></h4>
										
				    </div>
					
		    	</div>
		    	<div class="content" id="panel31">
					
					<div class="small-12 medium-12 large-12 columns">
					
						<div class="row content-details">
						  	<h4>Prepare the database, set up your credentials and deploy</h4>
						    
						    
								<p> This tutorial uses DB2 to create a database, which the App Connect Enterprise message flows will interact with. It is assumed you have DB2 already installed successfully, and that you have access to a userid which has the required level of DB2 administrative privileges. Create a new example database for this tutorial named USERS: </p>
								
								
									
									<ol>
									
									
										<li> Start a DB2 Command Window and execute the command:<br><code><span class="cmdname">db2 create database USERS</span></code>
										
										</li>
									
										<li> Next we will connect to the database which was just created, create a table and then insert some sample data. From the same window, start an interactive command session by typing <code><span class="cmdname">db2</span></code> and then execute these commands:<br><code><span class="cmdname">CONNECT TO USERS</span></code><br><code><span class="cmdname">CREATE TABLE MYSCHEMA.EMPLOYEES (PKEY INTEGER NOT NULL, FIRSTNAME VARCHAR(30), LASTNAME VARCHAR(30), COUNTRY VARCHAR(2), PRIMARY KEY(PKEY))</span></code><br><code><span class="cmdname">INSERT INTO MYSCHEMA.EMPLOYEES (PKEY, FIRSTNAME, LASTNAME, COUNTRY) VALUES (1, 'Ben', 'Thompson', 'GB')</span></code><br><code><span class="cmdname">INSERT INTO MYSCHEMA.EMPLOYEES (PKEY, FIRSTNAME, LASTNAME, COUNTRY) VALUES (2, 'Joe', 'Bloggs', 'GB')</span></code><br><code><span class="cmdname">INSERT INTO MYSCHEMA.EMPLOYEES (PKEY, FIRSTNAME, LASTNAME, COUNTRY) VALUES (3, 'Jan', 'Modaal', 'NL')</span></code><br><code><span class="cmdname">INSERT INTO MYSCHEMA.EMPLOYEES (PKEY, FIRSTNAME, LASTNAME, COUNTRY) VALUES (4, 'Otto', 'Normalverbraucher', 'DE')</span></code><br><code><span class="cmdname">INSERT INTO MYSCHEMA.EMPLOYEES (PKEY, FIRSTNAME, LASTNAME, COUNTRY) VALUES (5, 'John', 'Doe', 'US')</span></code>
										
										</li>
									
										<li> You can check the data has been successfully inserted by executing the command:<br><code><span class="cmdname">SELECT * FROM MYSCHEMA.EMPLOYEES</span></code>
										
										</li>
									
										<li> This tutorial also uses FileOutput nodes which will attempt to write output files to the directory <code><span class="cmdname">C:\temp</span></code>. Create this directory if it does not already exist, or edit all the FileOutput nodes in the message flow so that they write to a different directory suitable for your runtime environment.
										
										</li>
									
									
									</ol>
									
								
							
								<p> Create an integration node, set up your credentials and deploy by completing the following steps: </p>
								
								
									
									<ol>
									
									
										<li> Start an App Connect Enterprise command console and execute the following commands:<br><code><span class="cmdname">mqsicreatebroker TESTNODE</span></code><br><code><span class="cmdname">mqsistart TESTNODE</span></code><br><code><span class="cmdname">mqsicreateexecutiongroup TESTNODE -e server</span></code><br><code><span class="cmdname">mqsistop TESTNODE</span></code><br><code><span class="cmdname">mqsisetdbparms TESTNODE -n jdbc::mydbidentity -u db2admin -p pass123</span></code><br><code><span class="cmdname">mqsistart TESTNODE</span></code>
										
										</li>
									
										<li> The above mqsisetdbparms command configures the runtime with the required credentials (which have been abstracted from the JDBC Provider policy using the Security identity setting) for communicating with the database.
										
										</li>
									
										<li> Drag and drop deploy the provided BAR file named <span class="application">DatabaseRoute.bar</span> which you will find inside the <span class="application">ExampleDatabaseRoute</span> application. This BAR file includes the JDBC Provider policy and the application.
										
										</li>
									
									
									</ol>
									
								
							
						</div>
						
						<div class="row content-details">
							<h4></h4>
							<ul>
							
							</ul>
						</div>
							
					</div>
					
		    	</div>
		    	<div class="content" id="panel41">
		    		
					<div class="small-12 medium-12 large-12 columns">
					
				    	<div class="row content-details">
					      	<h4></h4>
					        
						    
								<p> <h4>Use the Flow Exerciser to test the tutorial scenario </h4></p>
								
								
									
									<ol>
									
									
										<li> Open <span class="resource">DatabaseRoute.msgflow</span>.
										
										
											
											<ul>
											
												
													<li> Click the Flow Exerciser icon <img src="http://ot4i.github.io/ot4i.tutorials//dist/images/icons/iib/startFlowExerciser.png" alt> to start testing the flow (when challenged you do not need to redeploy the flow again).</li>
												
													<li> Click the Send Message icon <img src="http://ot4i.github.io/ot4i.tutorials/dist/images/icons/iib/sendMessage.png" alt>.</li>
												
													<li> Six saved messages are provided. Five of these messages carry data which have corresponding entries in the database you just created. One message deliberately does not match the database content, and is provided so you can experiment with the keyNotFound terminal of the DatabaseRoute node. Each message provides a JSON structure which carries the FirstName and LastName for a row in the database. Select <span class="resource">InputMessageBenThompson</span> and click Send and your message is sent to the HTTPInput node.</li>
												
													<li> <span class="resource">InputMessageBenThompson</span> contains this data:<br><span class="resource">{"FirstName":"Ben","LastName":"Thompson"}</span></li>
												
													<li> After you close the dialog, the paths taken through the messageflow are highlighted. Depending on the value of the COUNTRY column of the database record, the DatabaseRoute node should route the data to the correct instance of a FileOutput node whose role is to write the data to an output file with the right country name. For example, <span class="resource">InputMessageBenThompson</span> should be written into <span class="resource">CountryGB.json</span></li>
												
											
											</ul>
											
										
										</li>
									
									
									</ol>
									
								
							
								<p> This tutorial has shown the DatabaseRoute node communicating with a DB2 database using JDBC in order to make message routing decisions. </p>
								
							
						</div>
						
						<div class="row content-details"> 	
							<h4>Find out more</h4>
							<ul>
							
								
																
								<li> <a href="javascript:;" onclick="openHelpSystem('/com.ibm.etools.mft.doc/ac37380_.htm')" title="Knowledge Center link to DatabaseRoute node">DatabaseRoute node</a> </li>
							   	
							
								
																
								<li> <a href="javascript:;" onclick="openHelpSystem('/com.ibm.etools.mft.doc/rt26110_.htm')" title="Knowledge Center link to Testing your message flow by using the Flow exerciser">Testing your message flow by using the Flow exerciser</a> </li>
							   	
							
							</ul>
						</div>
							
					</div>
					
				</div>	
			</div> <!-- tab-content -->
		</div> <!-- columns -->
	  </div> <!-- row --></body>
		<script src="https://ot4i.github.io/iib-tutorials/js/vendor/jquery.js"></script>
		<script src="https://ot4i.github.io/iib-tutorials/js/vendor/foundation.min.js"></script>
		<script src="https://ot4i.github.io/iib-tutorials/js/main.js"></script>
	</body>
<!-- body::End -->

</html>